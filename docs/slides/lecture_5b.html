<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ETC1010: Introduction to Data Analysis</title>
    <meta charset="utf-8" />
    <meta name="author" content="Nicholas Tierney" />
    <script src="libs/header-attrs-2.1/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/ninjutsu.css" rel="stylesheet" />
    <link href="libs/font-awesome-animation-1.0/font-awesome-animation-emi.css" rel="stylesheet" />
    <script src="libs/fontawesome-5.0.13/js/fontawesome-all.min.js"></script>
    <link href="libs/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.5/countdown.js"></script>
    <!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> 
    -->
    <link rel="icon" href="images/favicon.ico"  type='image/x-icon'/>    
    <link rel="stylesheet" href="assets/animate.css" type="text/css" />
    <link rel="stylesheet" href="assets/monash-logo.css" type="text/css" />
    <link rel="stylesheet" href="assets/monash-brand.css" type="text/css" />
    <link rel="stylesheet" href="assets/monash-fonts.css" type="text/css" />
    <link rel="stylesheet" href="assets/styles.css" type="text/css" />
    <link rel="stylesheet" href="assets/custom.css" type="text/css" />
    <link rel="stylesheet" href="assets/demo.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

  


&lt;!-- background-color: #006DAE --&gt;
&lt;!-- class: middle center hide-slide-number --&gt;

&lt;div class="shade_black"  style="width:60%;right:0;bottom:0;padding:10px;border: dashed 4px white;margin: auto;"&gt;
&lt;i class="fas fa-exclamation-circle"&gt;&lt;/i&gt; These slides are viewed best by Chrome and occasionally need to be refreshed if elements did not load properly. See &lt;a href=/&gt;here for PDF &lt;i class="fas fa-file-pdf"&gt;&lt;/i&gt;&lt;/a&gt;.
&lt;/div&gt;

&lt;br&gt;

.white[Press the **right arrow** to progress to the next slide!]

---

background-image: url(images/bg1.jpg)
background-size: cover
class: hide-slide-number split-70 title-slide
count: false

.column.shade_black[.content[

&lt;br&gt;

# .monash-blue.outline-text[ETC1010: Introduction to Data Analysis]

&lt;h2 class="monash-blue2 outline-text" style="font-size: 30pt!important;"&gt;Week 5, part B&lt;/h2&gt;

&lt;br&gt;

&lt;h2 style="font-weight:900!important;"&gt;Week of introduction&lt;/h2&gt;

.bottom_abs.width100[

Lecturer: *Nicholas Tierney*

Department of Econometrics and Business Statistics

<span>&lt;i class="fas  fa-envelope faa-float animated "&gt;&lt;/i&gt;</span>  ETC1010.Clayton-x@monash.edu

April 2020

&lt;br&gt;
]


]]



&lt;div class="column transition monash-m-new delay-1s" style="clip-path:url(#swipe__clip-path);"&gt;
&lt;div class="background-image" style="background-image:url('images/large.png');background-position: center;background-size:cover;margin-left:3px;"&gt;
&lt;svg class="clip-svg absolute"&gt;
&lt;defs&gt;
&lt;clipPath id="swipe__clip-path" clipPathUnits="objectBoundingBox"&gt;
&lt;polygon points="0.5745 0, 0.5 0.33, 0.42 0, 0 0, 0 1, 0.27 1, 0.27 0.59, 0.37 1, 0.634 1, 0.736 0.59, 0.736 1, 1 1, 1 0, 0.5745 0" /&gt;
&lt;/clipPath&gt;
&lt;/defs&gt;	
&lt;/svg&gt;
&lt;/div&gt;
&lt;/div&gt;









---
class: transition
# While the song is playing...

Draw a mental model / concept map of last lectures content on Missing Data.


---

background-image: url(https://www.kdnuggets.com/images/cartoon-turkey-data-science.jpg)
background-size: contain
background-position: 50% 50%

---
# Overview

- Different file formats
    - Audio / binary
- Web data
    - responsible scraping
    - scraping
    - JSON

---
class: transition
# Recap on some tricky topics

- pipes `%&gt;%` ("then")
- assignment `&lt;-` ("gets")

---
# The pipe operator: `%&gt;%`

- Code to tell a story about a little bunny foo foo (borrowed from https://r4ds.had.co.nz/pipes.html):
- Using functions for each verb: `hop()`, `scoop()`, `bop()`.

&gt; Little bunny Foo Foo
Went hopping through the forest
Scooping up the field mice
And bopping them on the head

---
# Approach: Intermediate steps

```r
foo_foo_1 &lt;- hop(foo_foo, through = forest)
foo_foo_2 &lt;- scoop(foo_foo_1, up = field_mice)
foo_foo_3 &lt;- bop(foo_foo_2, on = head)
```

- Main downside: forces you to name each intermediate element. 
- Sometimes these steps form natural names. If this is the case - go ahead.
- **But many times there are not natural names**
- Adding number suffixes to make the names unique leads to problems. 

---
# Approach: Intermediate steps

```r
foo_foo_1 &lt;- hop(foo_foo, through = forest)
foo_foo_2 &lt;- scoop(foo_foo_1, up = field_mice)
foo_foo_3 &lt;- bop(foo_foo_2, on = head)
```
- Code is cluttered with unimportant names
- Suffix has to be carefully incremented on each line.
- I've done this! 
- 99% of the time I miss a number somewhere, and there goes my evening ... debugging my code.

---
# Another Approach: Overwrite the original

```r
foo_foo &lt;- hop(foo_foo, through = forest)
foo_foo &lt;- scoop(foo_foo, up = field_mice)
foo_foo &lt;- bop(foo_foo, on = head)
```

- Overwrite originals instead of creating intermediate objects 
- Less typing (and less thinking). Less likely to make mistakes?
- **Painful debugging**: need to re-run the code from the top.
- Repitition of object - (`foo_foo` written 6 times!) Obscures what changes.

---
# (Yet) Another approach: function composition

```r
bop(
  scoop(
    hop(foo_foo, through = forest),
    up = field_mice
  ), 
  on = head
)
```

- You need to read inside-out, and right-to-left.
- Arguments are spread far apart
- Harder to read

---
# Pipe `%&gt;%` can help!

.pull-left[
`f(x)` 

`g(f(x))`

`h(g(f(x)))`
]

--

.pull-right[
`x %&gt;% f()`

`x %&gt;% f() %&gt;% g()`

`x %&gt;% f() %&gt;% g() %&gt;% h()`
]

---
# Solution: Use the pipe - `%&gt;%`


```r
foo_foo %&gt;%
  hop(through = forest) %&gt;%
  scoop(up = field_mice) %&gt;%
  bop(on = head)
```

- focusses on verbs, not nouns. 
- Can be read as a series of function compositions like actions. 

&gt; Foo Foo hops, then scoops, then bops. 

- read more at: https://r4ds.had.co.nz/pipes.html 

---
class: transition

# Assignment `&lt;-`

"gets"

---
# Assignment

We can perform calculations in R:

```r
1 + 1
read_csv("data.csv")
```

---
# Assignment

But what if we want to use that information later?

```r
1 + 1
read_csv("data.csv")
```

---
# Assignment

We can assign these things to an object using `&lt;-`

This reads as "gets".

```r
x &lt;- 1 + 1
my_data &lt;- read_csv("data.csv")
```

--

- x 'gets' 1+1
- my_data 'gets' the output of read_csv...
---
# Assignment

Then we can use those things in other calculations

```r
x &lt;- 1 + 1
my_data &lt;- read_csv("data.csv")

x * x

my_data %&gt;% 
  select(age, height, weight) %&gt;% 
  mutate(bmi = weight / height^2)
```

---
class: transition
# Take 3 minutes to discuss these two concepts with your breakout room

- What are pipes `%&gt;%`
- What is assignment? `&lt;-`

---
class: transition
# The many shapes and sizes of data

---
# Data as an audio file


```
## # A tibble: 50,001 x 3
##        t  left right
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     1    28    29
##  2     2    27    28
##  3     3    26    24
##  4     4    24    27
##  5     5    22    18
##  6     6    15    19
##  7     7    15    13
##  8     8    12    13
##  9     9    15    16
## 10    10    18    16
## # â€¦ with 49,991 more rows
```


---
# Plotting audio data?

&lt;img src="lecture_5b_files/figure-html/show-audio-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
# Compare left and right channels

&lt;img src="lecture_5b_files/figure-html/gg-compare-left-and-right-1.png" width="80%" style="display: block; margin: auto;" /&gt;


???

Oh, same sound is on both channels! A tad drab.

---
# Compute statistics





```r
df_wavs %&gt;%
  filter(channel == "left") %&gt;%
  group_by(word) %&gt;%
  summarise(
    m = mean(value),
    s = sd(value),
    mx = max(value),
    mn = min(value)
  ) %&gt;%
  as_table()
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; word &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; m &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; s &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; mx &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; mn &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; data &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.004 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1602.577 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8393 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -15386 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; word &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.009 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1506.626 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6601 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -11026 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
# Di's music





```
##                             artist      type        lvar        lave  lmax    lfener     lfreq
## Dancing Queen                 Abba      Rock  17600755.6 -90.0068667 29921 105.92095  59.57379
## Knowing Me                    Abba      Rock   9543020.9 -75.7667187 27626 102.83616  58.48031
## Take a Chance                 Abba      Rock   9049481.5 -98.0629244 26372 102.32488 124.59397
## Mamma Mia                     Abba      Rock   7557437.3 -90.4710616 28898 101.61648  48.76513
## Lay All You                   Abba      Rock   6282285.6 -88.9526309 27940 100.30076  74.02039
## Super Trouper                 Abba      Rock   4665866.7 -69.0208450 25531 100.24848  81.40140
## I Have A Dream                Abba      Rock   3369670.3 -71.6828788 14699 104.59686 305.18689
## The Winner                    Abba      Rock   1135862.0 -67.8190467  8928 104.34921 277.66056
## Money                         Abba      Rock   6146942.6 -76.2807500 22962 102.24066 165.15799
## SOS                           Abba      Rock   3482881.8 -74.1300038 15517 104.36243 146.73700
## V1                         Vivaldi Classical   3677296.2  66.6530970 24229  99.25243 329.53792
## V2                         Vivaldi Classical    771491.8  21.6560941  6936 104.36737 843.83240
## V3                         Vivaldi Classical   5227573.2  88.6465556 17721 104.61255 165.76781
## V4                         Vivaldi Classical    334719.1  13.8318847  4123 104.35005 293.99972
## V5                         Vivaldi Classical    836904.9  34.5677377 17306  88.82821 198.38305
## V6                         Vivaldi Classical  13936436.7 216.2317586 30355 104.82354 198.46716
## V7                         Vivaldi Classical   3636324.3   9.8366363 21450 100.52727 877.77243
## V8                         Vivaldi Classical    295397.4   2.8143227  2985 108.28717  58.41722
## V9                         Vivaldi Classical   4335879.0  10.9015767 22271 101.32881 176.53441
## V10                        Vivaldi Classical    472630.0   3.8890862  8194  98.83731 526.04942
## M1                          Mozart Classical   2819795.0  -5.8667602 14939 102.25358 342.26017
## M2                          Mozart Classical   2836957.9  -5.6074580 13382 102.04646 511.85517
## M3                          Mozart Classical   9089372.1  -5.9719205 25265 102.23796 429.27618
## M4                          Mozart Classical   4056229.7  -6.2272904 21328  97.59887 343.75319
## M5                          Mozart Classical   1568925.6  -6.1993790 15839  99.47580 288.44819
## M6                          Mozart Classical   7758409.1  -5.7700183 22496 101.66942 459.24182
## All in a Days Work            Eels      Rock  40275677.4 -10.6893416 32759 106.07617  65.48281
## Saturday Morning              Eels      Rock 129472199.3  50.2115773 32759 114.00229  41.40515
## The Good Old Days             Eels      Rock  18838849.0  -0.0222764 30386 105.45611 165.24210
## Love of the Loveless          Eels      Rock  43201194.3   1.8926897 32759 108.37835 174.64185
## Girl                          Eels      Rock  88547131.0   0.3358761 32744 112.00916 392.28702
## Agony                         Eels      Rock  16285811.4  -0.1405876 30106 103.94171 312.06322
## Rock Hard Times               Eels      Rock  54651552.8   1.9848514 32759 108.87503 312.37864
## Restraining                   Eels      Rock  12322434.4   1.0259790 23221 103.29906 185.59771
## Lone Wolf                     Eels      Rock  63878899.8   3.3592505 32759 109.53291  66.13469
## Wrong About Bobby             Eels      Rock  43668186.9  -2.0125667 32759 108.35559  98.83404
## Love Me Do                 Beatles      Rock  28806811.2  -5.7452189 24159 109.95808 126.50757
## I Want to Hold Your Hand   Beatles      Rock  61257693.6  -6.0340682 28502 111.81813 294.67263
## Cant Buy Me Love           Beatles      Rock  76729438.0  -5.9583971 30102 112.71792 100.20089
## I Feel Fine                Beatles      Rock  52497242.7  -5.7314591 29911 110.66333 110.39972
## Ticket to Ride             Beatles      Rock  68104547.0  -6.1449114 30415 111.59957 107.30853
## Help                       Beatles      Rock  52569372.5  -5.7166301 32318 110.34618 137.10594
## Yesterday                  Beatles      Rock  23080907.6  -6.0298337 28169 107.30541 173.50631
## Yellow Submarine           Beatles      Rock  39908667.5  -6.2616915 29061 109.47442  91.49508
## Eleanor Rigby              Beatles      Rock  18819753.2  -6.1265193 21680 108.65894 164.92667
## Penny Lane                 Beatles      Rock  58614798.7  -5.9971242 31131 111.18901  92.46240
## B1                       Beethoven Classical   8368952.9  -0.9538330 26645 101.74095 354.12025
## B2                       Beethoven Classical    293608.3  -0.1247094  4554 103.26160 316.03761
## B3                       Beethoven Classical   8051764.6  -0.3316964 24194 101.20132 397.18666
## B4                       Beethoven Classical  23493873.6  -0.9411538 32766 106.18220 529.26679
## B5                       Beethoven Classical   1640232.8   1.3899979 20877  94.59029 445.00551
## B6                       Beethoven Classical    343973.1  -2.4748955  9225  93.38874 331.68283
## B7                       Beethoven Classical   3644784.2  -1.0426907 24633  97.86394 181.01349
## B8                       Beethoven Classical  15030950.3  -1.4394652 26066 106.39731 249.08280
## The Memory of Trees           Enya  New wave   1135493.1 -10.6183398  9994 102.16132 155.06430
## Anywhere Is                   Enya  New wave  12230252.2 -17.8372700 24968 105.75748  79.31957
## Pax Deorum                    Enya  New wave   1723627.9  -6.8327065 13227 101.86845  49.01748
## Waterloo                      Abba      Rock  24898675.9 -93.9961871 29830 107.73299 146.04306
## V11                        Vivaldi Classical   1879989.2  12.7213373  8601 105.81750  58.83780
## V12                        Vivaldi Classical    737349.6   5.7190022  7089 102.92123 175.94562
## V13                        Vivaldi Classical   2865979.9  21.4467629 17282 102.11314  61.44533
## Hey Jude                   Beatles      Rock   8651854.1  -6.1322408 18509  83.88195 219.53773
```

---
# Plot Di's music

&lt;img src="lecture_5b_files/figure-html/gg-di-music-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
# Plot Di's Music

&lt;img src="lecture_5b_files/figure-html/gg-di-music-points-1.png" width="80%" style="display: block; margin: auto;" /&gt;

Abba is just different from everyone else!

---
# Question time:

-   "How does `data` appear different than `statistics` in the time series?"
-   "What format is the data in an audio file?"
-   "How is Abba different from the other music clips?",

<div class="countdown" id="timer_5e9e9189" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">01</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">30</span></code>
</div>

---
# Why look at audio data?

- Data comes in many shapes and sizes
- Audio data can be transformed ("rectangled") into a data.frame
- Another type of data is data on the web.
- Extracting data from websites is called "web scraping". 

---
# Scraping the web: what? why?

- Increasing amount of data is available on the web.
- These data are provided in an unstructured format: you can always copy&amp;paste, but it's 
time-consuming and prone to errors.
- Web scraping is the process of extracting this information automatically and transform it into 
a structured dataset.

---
# Scraping the web: what? why?


1. Screen scraping: extract data from source code of website, with html parser (easy) or regular expression matching (less easy).
2. Web APIs (application programming interface): website offers a set of structured http  requests that return JSON or XML files.
- Why R? It includes all tools necessary to do web scraping, familiarity, direct analysis of data... But python, perl, java are also efficient tools.

---
class: transition
# Web Scraping with `rvest` and `polite`

---
# Hypertext Markup Language

Most of the data on the web is still largely available as HTML - while it is structured (hierarchical / tree based) it often is not available in a form useful for analysis (flat / tidy).

```html
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;This is a title&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p align="center"&gt;Hello world!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
```

---
# What if we want to extract parts of this text out?

```html
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;This is a title&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p align="center"&gt;Hello world!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
```

--

- `read_html()`: read HTML in (like `read_csv` and co!)

--

- `html_nodes()`: select specified nodes from the HTML document using CSS selectors.

---
# Let's read it in with `read_html`


```r
example &lt;- read_html(here::here("slides/data/example.html"))
example
## {html_document}
## &lt;html&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;\n&lt;title&gt;This  ...
## [2] &lt;body&gt;\n    &lt;p align="center"&gt;Hello world!&lt;/p&gt;\n  &lt;/body&gt;
```

--

- We have two parts - head and body - which makes sense:

```html
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;This is a title&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p align="center"&gt;Hello world!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
```



---
# Now let's get the title


```r
example %&gt;% 
  html_nodes("title")
## {xml_nodeset (1)}
## [1] &lt;title&gt;This is a title&lt;/title&gt;
```

--

```html
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;This is a title&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p align="center"&gt;Hello world!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
```


---
# Now let's get the paragraph text


```r
example %&gt;% 
  html_nodes("p")
## {xml_nodeset (1)}
## [1] &lt;p align="center"&gt;Hello world!&lt;/p&gt;
```

--

```html
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;This is a title&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p align="center"&gt;Hello world!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
```


---
# Rough summary

- `read_html` - read in a html file
- `html_nodes` - select the parts of the html file we want to look at
    - This requires knowing about the website structure
    - But it turns out website are much...much more complicated than out little example file

---
class: transition
# rvest + polite: 

Simplify processing and manipulating HTML data

- `bow()` - check if the data can be scraped appropriately
- `scrape()` - scrape website data (with nice defaults)
- `html_nodes()` - select specified nodes from the HTML document using CSS selectors.
- `html_table` - parse an HTML table into a data frame.
- `html_text` - extract tag pairs' content.

---
# SelectorGadget: css selectors

- Using a tool called selector gadget to **help** identify the html elements of interest
- Does this by constructing a css selector which can be used to subset the html document.

---
# SelectorGadget: css selectors

.small[
Selector          |  Example         |     Description
------------      |------------------|      ------------------------------------------------
element           |  `p`             |      Select all &amp;lt;p&amp;gt; elements
element element   |  `div p`         |      Select all &amp;lt;p&amp;gt; elements inside a &amp;lt;div&amp;gt; element          
element&gt;element   |  `div &gt; p`       |      Select all &amp;lt;p&amp;gt; elements with &amp;lt;div&amp;gt; as a parent
.class            |  `.title`        |      Select all elements with class="title"
\#id              |  `.name`         |      Select all elements with id="name"
[attribute]       |  `[class]`       |      Select all elements with a class attribute
[attribute=value] |  `[class=title]` |      Select all elements with class="title"
]

---
# SelectorGadget

- SelectorGadget: Open source tool that eases CSS selector generation and discovery
- Install the [Chrome Extension](https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb) 
- A box will open in the bottom right of the website. Click on a page element 
that you would like your selector to match (it will turn green). SelectorGadget 
will then generate a minimal CSS selector for that element, and will highlight 
(yellow) everything that is 
matched by the selector. 
- Now click on a highlighted element to remove it from the selector (red), or 
click on an unhighlighted element to add it to the selector. Through this process 
of selection and rejection, SelectorGadget helps you come up with the appropriate 
CSS selector for your needs.

---
# Top 250 movies on IMDB

Take a look at the source code, look for the tag `table` tag:
&lt;br&gt;
http://www.imdb.com/chart/top


&lt;img src="images/imdb_top_250.png" width="80%" style="display: block; margin: auto;" /&gt;


---
# First check to make sure you're allowed!


```r
# install.packages("remotes")
# remotes::install_github("dmi3kno/polite")
library(polite)
bow("http://www.imdb.com")
## &lt;polite session&gt; http://www.imdb.com
##     User-agent: polite R package - https://github.com/dmi3kno/polite
##     robots.txt: 26 rules are defined for 1 bots
##    Crawl delay: 5 sec
##   The path is scrapable for this user-agent
```

--


```r
bow("http://www.facebook.com")
## &lt;polite session&gt; http://www.facebook.com
##     User-agent: polite R package - https://github.com/dmi3kno/polite
##     robots.txt: 438 rules are defined for 20 bots
##    Crawl delay: 5 sec
##   The path is not scrapable for this user-agent
```

---
# Join in

- Go to [rstudio.cloud](https://rstudio.cloud/) `\(\rightarrow\)` ida-exercise-5a
- If you want to use R / Rstudio on your laptop:
  - Install R + Rstudio (see [Stuart Lee's Guide](https://github.com/sa-lee/installr))
  - open RStudio
  - type the following:

```r
# install.packages("usethis")
library(usethis)
use_course("https://ida.numbat.space/exercises/5b/ida-exercise-5b.zip")
```

---

# Demo

Let's go to http://www.imdb.com/chart/top

---
# Bow and scrape


```r
imdb_session &lt;- bow("http://www.imdb.com/chart/top")

imdb_session 
## &lt;polite session&gt; http://www.imdb.com/chart/top
##     User-agent: polite R package - https://github.com/dmi3kno/polite
##     robots.txt: 26 rules are defined for 1 bots
##    Crawl delay: 5 sec
##   The path is scrapable for this user-agent

imdb_data &lt;- scrape(imdb_session)

imdb_data
## {html_document}
## &lt;html xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml"&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;\n&lt;script type ...
## [2] &lt;body id="styleguide-v2" class="fixed"&gt;\n            &lt;img height="1" width="1" style="dis ...
```


---
# Select and format pieces: titles - `html_nodes()`


```r
library(rvest)
imdb_data %&gt;%
  html_nodes(".titleColumn a")
## {xml_nodeset (250)}
##  [1] &lt;a href="/title/tt0111161/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [2] &lt;a href="/title/tt0068646/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [3] &lt;a href="/title/tt0071562/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [4] &lt;a href="/title/tt0468569/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [5] &lt;a href="/title/tt0050083/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [6] &lt;a href="/title/tt0108052/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [7] &lt;a href="/title/tt0167260/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [8] &lt;a href="/title/tt0110912/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
##  [9] &lt;a href="/title/tt0060196/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [10] &lt;a href="/title/tt0120737/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [11] &lt;a href="/title/tt0137523/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [12] &lt;a href="/title/tt0109830/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [13] &lt;a href="/title/tt1375666/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [14] &lt;a href="/title/tt0080684/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [15] &lt;a href="/title/tt0167261/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [16] &lt;a href="/title/tt0133093/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [17] &lt;a href="/title/tt0099685/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [18] &lt;a href="/title/tt0073486/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [19] &lt;a href="/title/tt0047478/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## [20] &lt;a href="/title/tt0114369/?pf_rd_m=A2FGELUUNOQJNL&amp;amp;pf_rd_p=e31d89dd-322d-4646-8962-32 ...
## ...
```


---
# Select and format pieces: titles - `html_text() `


```r
imdb_data %&gt;%
  html_nodes(".titleColumn a") %&gt;%
  html_text()
##   [1] "The Shawshank Redemption"                                            
##   [2] "The Godfather"                                                       
##   [3] "The Godfather: Part II"                                              
##   [4] "The Dark Knight"                                                     
##   [5] "12 Angry Men"                                                        
##   [6] "Schindler's List"                                                    
##   [7] "The Lord of the Rings: The Return of the King"                       
##   [8] "Pulp Fiction"                                                        
##   [9] "The Good, the Bad and the Ugly"                                      
##  [10] "The Lord of the Rings: The Fellowship of the Ring"                   
##  [11] "Fight Club"                                                          
##  [12] "Forrest Gump"                                                        
##  [13] "Inception"                                                           
##  [14] "Star Wars: Episode V - The Empire Strikes Back"                      
##  [15] "The Lord of the Rings: The Two Towers"                               
##  [16] "The Matrix"                                                          
##  [17] "Goodfellas"                                                          
##  [18] "One Flew Over the Cuckoo's Nest"                                     
##  [19] "Seven Samurai"                                                       
##  [20] "Se7en"                                                               
##  [21] "City of God"                                                         
##  [22] "Life Is Beautiful"                                                   
##  [23] "The Silence of the Lambs"                                            
##  [24] "It's a Wonderful Life"                                               
##  [25] "Star Wars"                                                           
##  [26] "Parasite"                                                            
##  [27] "Saving Private Ryan"                                                 
##  [28] "Spirited Away"                                                       
##  [29] "The Green Mile"                                                      
##  [30] "Interstellar"                                                        
##  [31] "Leon: The Professional"                                              
##  [32] "The Usual Suspects"                                                  
##  [33] "Seppuku"                                                             
##  [34] "The Lion King"                                                       
##  [35] "American History X"                                                  
##  [36] "The Pianist"                                                         
##  [37] "Terminator 2: Judgment Day"                                          
##  [38] "Back to the Future"                                                  
##  [39] "Modern Times"                                                        
##  [40] "Psycho"                                                              
##  [41] "Gladiator"                                                           
##  [42] "City Lights"                                                         
##  [43] "The Intouchables"                                                    
##  [44] "The Departed"                                                        
##  [45] "Whiplash"                                                            
##  [46] "The Prestige"                                                        
##  [47] "Once Upon a Time in the West"                                        
##  [48] "Grave of the Fireflies"                                              
##  [49] "Casablanca"                                                          
##  [50] "Joker"                                                               
##  [51] "Cinema Paradiso"                                                     
##  [52] "Rear Window"                                                         
##  [53] "Alien"                                                               
##  [54] "Apocalypse Now"                                                      
##  [55] "Memento"                                                             
##  [56] "Raiders of the Lost Ark"                                             
##  [57] "The Great Dictator"                                                  
##  [58] "The Lives of Others"                                                 
##  [59] "Django Unchained"                                                    
##  [60] "Paths of Glory"                                                      
##  [61] "The Shining"                                                         
##  [62] "Avengers: Infinity War"                                              
##  [63] "WALLÂ·E"                                                              
##  [64] "Sunset Boulevard"                                                    
##  [65] "Spider-Man: Into the Spider-Verse"                                   
##  [66] "Princess Mononoke"                                                   
##  [67] "Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb"
##  [68] "Oldboy"                                                              
##  [69] "Witness for the Prosecution"                                         
##  [70] "Avengers: Endgame"                                                   
##  [71] "The Dark Knight Rises"                                               
##  [72] "Once Upon a Time in America"                                         
##  [73] "Aliens"                                                              
##  [74] "Your Name."                                                          
##  [75] "Coco"                                                                
##  [76] "American Beauty"                                                     
##  [77] "Braveheart"                                                          
##  [78] "1917"                                                                
##  [79] "Das Boot"                                                            
##  [80] "3 Idiots"                                                            
##  [81] "Toy Story"                                                           
##  [82] "Tengoku to jigoku"                                                   
##  [83] "Taare Zameen Par"                                                    
##  [84] "Star Wars: Episode VI - Return of the Jedi"                          
##  [85] "Amadeus"                                                             
##  [86] "Reservoir Dogs"                                                      
##  [87] "Inglourious Basterds"                                                
##  [88] "Good Will Hunting"                                                   
##  [89] "2001: A Space Odyssey"                                               
##  [90] "Requiem for a Dream"                                                 
##  [91] "Vertigo"                                                             
##  [92] "M - Eine Stadt sucht einen MÃ¶rder"                                   
##  [93] "Dangal"                                                              
##  [94] "Eternal Sunshine of the Spotless Mind"                               
##  [95] "Citizen Kane"                                                        
##  [96] "The Hunt"                                                            
##  [97] "CapharnaÃ¼m"                                                          
##  [98] "Full Metal Jacket"                                                   
##  [99] "North by Northwest"                                                  
## [100] "A Clockwork Orange"                                                  
## [101] "Snatch"                                                              
## [102] "The Kid"                                                             
## [103] "Bicycle Thieves"                                                     
## [104] "Singin' in the Rain"                                                 
## [105] "Scarface"                                                            
## [106] "Taxi Driver"                                                         
## [107] "Amelie"                                                              
## [108] "Lawrence of Arabia"                                                  
## [109] "The Sting"                                                           
## [110] "Toy Story 3"                                                         
## [111] "Metropolis"                                                          
## [112] "For a Few Dollars More"                                              
## [113] "Ikiru"                                                               
## [114] "Jodaeiye Nader az Simin"                                             
## [115] "Double Indemnity"                                                    
## [116] "The Apartment"                                                       
## [117] "To Kill a Mockingbird"                                               
## [118] "Incendies"                                                           
## [119] "Indiana Jones and the Last Crusade"                                  
## [120] "Up"                                                                  
## [121] "L.A. Confidential"                                                   
## [122] "Monty Python and the Holy Grail"                                     
## [123] "Heat"                                                                
## [124] "Rashomon"                                                            
## [125] "Die Hard"                                                            
## [126] "Yojimbo"                                                             
## [127] "Batman Begins"                                                       
## [128] "Green Book"                                                          
## [129] "Downfall"                                                            
## [130] "Unforgiven"                                                          
## [131] "Idi i smotri"                                                        
## [132] "Bacheha-Ye aseman"                                                   
## [133] "Some Like It Hot"                                                    
## [134] "Howl's Moving Castle"                                                
## [135] "Ran"                                                                 
## [136] "The Great Escape"                                                    
## [137] "All About Eve"                                                       
## [138] "A Beautiful Mind"                                                    
## [139] "Casino"                                                              
## [140] "Pan's Labyrinth"                                                     
## [141] "My Neighbor Totoro"                                                  
## [142] "El secreto de sus ojos"                                              
## [143] "Raging Bull"                                                         
## [144] "Lock, Stock and Two Smoking Barrels"                                 
## [145] "The Wolf of Wall Street"                                             
## [146] "The Treasure of the Sierra Madre"                                    
## [147] "Judgment at Nuremberg"                                               
## [148] "There Will Be Blood"                                                 
## [149] "Babam ve Oglum"                                                      
## [150] "Three Billboards Outside Ebbing, Missouri"                           
## [151] "The Gold Rush"                                                       
## [152] "Chinatown"                                                           
## [153] "Dial M for Murder"                                                   
## [154] "V for Vendetta"                                                      
## [155] "Det sjunde inseglet"                                                 
## [156] "Inside Out"                                                          
## [157] "No Country for Old Men"                                              
## [158] "Warrior"                                                             
## [159] "Shutter Island"                                                      
## [160] "Trainspotting"                                                       
## [161] "The Elephant Man"                                                    
## [162] "The Sixth Sense"                                                     
## [163] "The Thing"                                                           
## [164] "Room"                                                                
## [165] "Gone with the Wind"                                                  
## [166] "Jurassic Park"                                                       
## [167] "Blade Runner"                                                        
## [168] "The Bridge on the River Kwai"                                        
## [169] "SmultronstÃ¤llet"                                                     
## [170] "Finding Nemo"                                                        
## [171] "The Third Man"                                                       
## [172] "On the Waterfront"                                                   
## [173] "Stalker"                                                             
## [174] "Fargo"                                                               
## [175] "Kill Bill: Vol. 1"                                                   
## [176] "The Truman Show"                                                     
## [177] "Gran Torino"                                                         
## [178] "TÃ´kyÃ´ monogatari"                                                    
## [179] "The Deer Hunter"                                                     
## [180] "Memories of Murder"                                                  
## [181] "Relatos salvajes"                                                    
## [182] "Eskiya"                                                              
## [183] "Andhadhun"                                                           
## [184] "Klaus"                                                               
## [185] "The Big Lebowski"                                                    
## [186] "Mary and Max"                                                        
## [187] "In the Name of the Father"                                           
## [188] "Gone Girl"                                                           
## [189] "Hacksaw Ridge"                                                       
## [190] "The Grand Budapest Hotel"                                            
## [191] "Ford v Ferrari"                                                      
## [192] "Persona"                                                             
## [193] "Mr. Smith Goes to Washington"                                        
## [194] "How to Train Your Dragon"                                            
## [195] "Before Sunrise"                                                      
## [196] "The General"                                                         
## [197] "Catch Me If You Can"                                                 
## [198] "Sherlock Jr."                                                        
## [199] "Prisoners"                                                           
## [200] "12 Years a Slave"                                                    
## [201] "Cool Hand Luke"                                                      
## [202] "Mad Max: Fury Road"                                                  
## [203] "Stand by Me"                                                         
## [204] "Network"                                                             
## [205] "Le salaire de la peur"                                               
## [206] "Barry Lyndon"                                                        
## [207] "Into the Wild"                                                       
## [208] "Million Dollar Baby"                                                 
## [209] "Monty Python's Life of Brian"                                        
## [210] "Platoon"                                                             
## [211] "Hachi: A Dog's Tale"                                                 
## [212] "Ben-Hur"                                                             
## [213] "Rush"                                                                
## [214] "Andrei Rublev"                                                       
## [215] "Logan"                                                               
## [216] "La passion de Jeanne d'Arc"                                          
## [217] "Harry Potter and the Deathly Hallows: Part 2"                        
## [218] "Dead Poets Society"                                                  
## [219] "Les quatre cents coups"                                              
## [220] "Rang De Basanti"                                                     
## [221] "Hotel Rwanda"                                                        
## [222] "Amores perros"                                                       
## [223] "Kaze no tani no Naushika"                                            
## [224] "Spotlight"                                                           
## [225] "Ah-ga-ssi"                                                           
## [226] "Rebecca"                                                             
## [227] "Rocky"                                                               
## [228] "Portrait of a Lady on Fire"                                          
## [229] "Monsters, Inc."                                                      
## [230] "La haine"                                                            
## [231] "It Happened One Night"                                               
## [232] "Faa yeung nin wa"                                                    
## [233] "Gangs of Wasseypur"                                                  
## [234] "Before Sunset"                                                       
## [235] "The Princess Bride"                                                  
## [236] "The Help"                                                            
## [237] "Ace in the Hole"                                                     
## [238] "Paris, Texas"                                                        
## [239] "The Red Shoes"                                                       
## [240] "The Invisible Guest"                                                 
## [241] "Drishyam"                                                            
## [242] "The Terminator"                                                      
## [243] "Lagaan: Once Upon a Time in India"                                   
## [244] "Butch Cassidy and the Sundance Kid"                                  
## [245] "Akira"                                                               
## [246] "Aladdin"                                                             
## [247] "PK"                                                                  
## [248] "Kis Uykusu"                                                          
## [249] "Fanny och Alexander"                                                 
## [250] "Hera Pheri"
```

---
# Select and format pieces: save it


```r
titles &lt;- imdb_data %&gt;%
  html_nodes(".titleColumn a") %&gt;%
  html_text()
```

---
# Select and format pieces: years - nodes


```r
imdb_data %&gt;%
  html_nodes(".secondaryInfo")
## {xml_nodeset (250)}
##  [1] &lt;span class="secondaryInfo"&gt;(1994)&lt;/span&gt;
##  [2] &lt;span class="secondaryInfo"&gt;(1972)&lt;/span&gt;
##  [3] &lt;span class="secondaryInfo"&gt;(1974)&lt;/span&gt;
##  [4] &lt;span class="secondaryInfo"&gt;(2008)&lt;/span&gt;
##  [5] &lt;span class="secondaryInfo"&gt;(1957)&lt;/span&gt;
##  [6] &lt;span class="secondaryInfo"&gt;(1993)&lt;/span&gt;
##  [7] &lt;span class="secondaryInfo"&gt;(2003)&lt;/span&gt;
##  [8] &lt;span class="secondaryInfo"&gt;(1994)&lt;/span&gt;
##  [9] &lt;span class="secondaryInfo"&gt;(1966)&lt;/span&gt;
## [10] &lt;span class="secondaryInfo"&gt;(2001)&lt;/span&gt;
## [11] &lt;span class="secondaryInfo"&gt;(1999)&lt;/span&gt;
## [12] &lt;span class="secondaryInfo"&gt;(1994)&lt;/span&gt;
## [13] &lt;span class="secondaryInfo"&gt;(2010)&lt;/span&gt;
## [14] &lt;span class="secondaryInfo"&gt;(1980)&lt;/span&gt;
## [15] &lt;span class="secondaryInfo"&gt;(2002)&lt;/span&gt;
## [16] &lt;span class="secondaryInfo"&gt;(1999)&lt;/span&gt;
## [17] &lt;span class="secondaryInfo"&gt;(1990)&lt;/span&gt;
## [18] &lt;span class="secondaryInfo"&gt;(1975)&lt;/span&gt;
## [19] &lt;span class="secondaryInfo"&gt;(1954)&lt;/span&gt;
## [20] &lt;span class="secondaryInfo"&gt;(1995)&lt;/span&gt;
## ...
```

---
# Select and format pieces: years - text


```r
imdb_data %&gt;%
  html_nodes(".secondaryInfo") %&gt;%
  html_text() 
##   [1] "(1994)" "(1972)" "(1974)" "(2008)" "(1957)" "(1993)" "(2003)" "(1994)" "(1966)" "(2001)"
##  [11] "(1999)" "(1994)" "(2010)" "(1980)" "(2002)" "(1999)" "(1990)" "(1975)" "(1954)" "(1995)"
##  [21] "(2002)" "(1997)" "(1991)" "(1946)" "(1977)" "(2019)" "(1998)" "(2001)" "(1999)" "(2014)"
##  [31] "(1994)" "(1995)" "(1962)" "(1994)" "(1998)" "(2002)" "(1991)" "(1985)" "(1936)" "(1960)"
##  [41] "(2000)" "(1931)" "(2011)" "(2006)" "(2014)" "(2006)" "(1968)" "(1988)" "(1942)" "(2019)"
##  [51] "(1988)" "(1954)" "(1979)" "(1979)" "(2000)" "(1981)" "(1940)" "(2006)" "(2012)" "(1957)"
##  [61] "(1980)" "(2018)" "(2008)" "(1950)" "(2018)" "(1997)" "(1964)" "(2003)" "(1957)" "(2019)"
##  [71] "(2012)" "(1984)" "(1986)" "(2016)" "(2017)" "(1999)" "(1995)" "(2019)" "(1981)" "(2009)"
##  [81] "(1995)" "(1963)" "(2007)" "(1983)" "(1984)" "(1992)" "(2009)" "(1997)" "(1968)" "(2000)"
##  [91] "(1958)" "(1931)" "(2016)" "(2004)" "(1941)" "(2012)" "(2018)" "(1987)" "(1959)" "(1971)"
## [101] "(2000)" "(1921)" "(1948)" "(1952)" "(1983)" "(1976)" "(2001)" "(1962)" "(1973)" "(2010)"
## [111] "(1927)" "(1965)" "(1952)" "(2011)" "(1944)" "(1960)" "(1962)" "(2010)" "(1989)" "(2009)"
## [121] "(1997)" "(1975)" "(1995)" "(1950)" "(1988)" "(1961)" "(2005)" "(2018)" "(2004)" "(1992)"
## [131] "(1985)" "(1997)" "(1959)" "(2004)" "(1985)" "(1963)" "(1950)" "(2001)" "(1995)" "(2006)"
## [141] "(1988)" "(2009)" "(1980)" "(1998)" "(2013)" "(1948)" "(1961)" "(2007)" "(2005)" "(2017)"
## [151] "(1925)" "(1974)" "(1954)" "(2005)" "(1957)" "(2015)" "(2007)" "(2011)" "(2010)" "(1996)"
## [161] "(1980)" "(1999)" "(1982)" "(2015)" "(1939)" "(1993)" "(1982)" "(1957)" "(1957)" "(2003)"
## [171] "(1949)" "(1954)" "(1979)" "(1996)" "(2003)" "(1998)" "(2008)" "(1953)" "(1978)" "(2003)"
## [181] "(2014)" "(1996)" "(2018)" "(2019)" "(1998)" "(2009)" "(1993)" "(2014)" "(2016)" "(2014)"
## [191] "(2019)" "(1966)" "(1939)" "(2010)" "(1995)" "(1926)" "(2002)" "(1924)" "(2013)" "(2013)"
## [201] "(1967)" "(2015)" "(1986)" "(1976)" "(1953)" "(1975)" "(2007)" "(2004)" "(1979)" "(1986)"
## [211] "(2009)" "(1959)" "(2013)" "(1966)" "(2017)" "(1928)" "(2011)" "(1989)" "(1959)" "(2006)"
## [221] "(2004)" "(2000)" "(1984)" "(2015)" "(2016)" "(1940)" "(1976)" "(2019)" "(2001)" "(1995)"
## [231] "(1934)" "(2000)" "(2012)" "(2004)" "(1987)" "(2011)" "(1951)" "(1984)" "(1948)" "(2016)"
## [241] "(2015)" "(1984)" "(2001)" "(1969)" "(1988)" "(1992)" "(2014)" "(2014)" "(1982)" "(2000)"
```

---
# Select and format pieces: years - remove-brackets


```r
imdb_data %&gt;%
  html_nodes(".secondaryInfo") %&gt;%
  html_text() %&gt;%
  str_remove("\\(") %&gt;% # remove (
  str_remove("\\)") %&gt;% # remove )
  as.numeric()
##   [1] 1994 1972 1974 2008 1957 1993 2003 1994 1966 2001 1999 1994 2010 1980 2002 1999 1990 1975
##  [19] 1954 1995 2002 1997 1991 1946 1977 2019 1998 2001 1999 2014 1994 1995 1962 1994 1998 2002
##  [37] 1991 1985 1936 1960 2000 1931 2011 2006 2014 2006 1968 1988 1942 2019 1988 1954 1979 1979
##  [55] 2000 1981 1940 2006 2012 1957 1980 2018 2008 1950 2018 1997 1964 2003 1957 2019 2012 1984
##  [73] 1986 2016 2017 1999 1995 2019 1981 2009 1995 1963 2007 1983 1984 1992 2009 1997 1968 2000
##  [91] 1958 1931 2016 2004 1941 2012 2018 1987 1959 1971 2000 1921 1948 1952 1983 1976 2001 1962
## [109] 1973 2010 1927 1965 1952 2011 1944 1960 1962 2010 1989 2009 1997 1975 1995 1950 1988 1961
## [127] 2005 2018 2004 1992 1985 1997 1959 2004 1985 1963 1950 2001 1995 2006 1988 2009 1980 1998
## [145] 2013 1948 1961 2007 2005 2017 1925 1974 1954 2005 1957 2015 2007 2011 2010 1996 1980 1999
## [163] 1982 2015 1939 1993 1982 1957 1957 2003 1949 1954 1979 1996 2003 1998 2008 1953 1978 2003
## [181] 2014 1996 2018 2019 1998 2009 1993 2014 2016 2014 2019 1966 1939 2010 1995 1926 2002 1924
## [199] 2013 2013 1967 2015 1986 1976 1953 1975 2007 2004 1979 1986 2009 1959 2013 1966 2017 1928
## [217] 2011 1989 1959 2006 2004 2000 1984 2015 2016 1940 1976 2019 2001 1995 1934 2000 2012 2004
## [235] 1987 2011 1951 1984 1948 2016 2015 1984 2001 1969 1988 1992 2014 2014 1982 2000
```

---
# Select and format pieces: years - `parse_number()`


```r
imdb_data %&gt;%
  html_nodes(".secondaryInfo") %&gt;%
  html_text() %&gt;%
  parse_number()
##   [1] 1994 1972 1974 2008 1957 1993 2003 1994 1966 2001 1999 1994 2010 1980 2002 1999 1990 1975
##  [19] 1954 1995 2002 1997 1991 1946 1977 2019 1998 2001 1999 2014 1994 1995 1962 1994 1998 2002
##  [37] 1991 1985 1936 1960 2000 1931 2011 2006 2014 2006 1968 1988 1942 2019 1988 1954 1979 1979
##  [55] 2000 1981 1940 2006 2012 1957 1980 2018 2008 1950 2018 1997 1964 2003 1957 2019 2012 1984
##  [73] 1986 2016 2017 1999 1995 2019 1981 2009 1995 1963 2007 1983 1984 1992 2009 1997 1968 2000
##  [91] 1958 1931 2016 2004 1941 2012 2018 1987 1959 1971 2000 1921 1948 1952 1983 1976 2001 1962
## [109] 1973 2010 1927 1965 1952 2011 1944 1960 1962 2010 1989 2009 1997 1975 1995 1950 1988 1961
## [127] 2005 2018 2004 1992 1985 1997 1959 2004 1985 1963 1950 2001 1995 2006 1988 2009 1980 1998
## [145] 2013 1948 1961 2007 2005 2017 1925 1974 1954 2005 1957 2015 2007 2011 2010 1996 1980 1999
## [163] 1982 2015 1939 1993 1982 1957 1957 2003 1949 1954 1979 1996 2003 1998 2008 1953 1978 2003
## [181] 2014 1996 2018 2019 1998 2009 1993 2014 2016 2014 2019 1966 1939 2010 1995 1926 2002 1924
## [199] 2013 2013 1967 2015 1986 1976 1953 1975 2007 2004 1979 1986 2009 1959 2013 1966 2017 1928
## [217] 2011 1989 1959 2006 2004 2000 1984 2015 2016 1940 1976 2019 2001 1995 1934 2000 2012 2004
## [235] 1987 2011 1951 1984 1948 2016 2015 1984 2001 1969 1988 1992 2014 2014 1982 2000
```

---
# Select and format pieces: years - remove-brackets


```r
years &lt;- imdb_data %&gt;%
  html_nodes(".secondaryInfo") %&gt;%
  html_text() %&gt;%
  str_remove("\\(") %&gt;% # remove (
  str_remove("\\)") %&gt;% # remove )
  as.numeric()
```

---
# Select and format pieces: scores - nodes


```r
imdb_data %&gt;%
  html_nodes(".imdbRating strong")
## {xml_nodeset (250)}
##  [1] &lt;strong title="9.2 based on 2,223,299 user ratings"&gt;9.2&lt;/strong&gt;
##  [2] &lt;strong title="9.1 based on 1,532,071 user ratings"&gt;9.1&lt;/strong&gt;
##  [3] &lt;strong title="9.0 based on 1,072,485 user ratings"&gt;9.0&lt;/strong&gt;
##  [4] &lt;strong title="9.0 based on 2,197,842 user ratings"&gt;9.0&lt;/strong&gt;
##  [5] &lt;strong title="8.9 based on 649,752 user ratings"&gt;8.9&lt;/strong&gt;
##  [6] &lt;strong title="8.9 based on 1,157,929 user ratings"&gt;8.9&lt;/strong&gt;
##  [7] &lt;strong title="8.9 based on 1,575,407 user ratings"&gt;8.9&lt;/strong&gt;
##  [8] &lt;strong title="8.8 based on 1,744,136 user ratings"&gt;8.8&lt;/strong&gt;
##  [9] &lt;strong title="8.8 based on 657,802 user ratings"&gt;8.8&lt;/strong&gt;
## [10] &lt;strong title="8.8 based on 1,588,133 user ratings"&gt;8.8&lt;/strong&gt;
## [11] &lt;strong title="8.8 based on 1,772,059 user ratings"&gt;8.8&lt;/strong&gt;
## [12] &lt;strong title="8.8 based on 1,715,120 user ratings"&gt;8.8&lt;/strong&gt;
## [13] &lt;strong title="8.7 based on 1,949,598 user ratings"&gt;8.7&lt;/strong&gt;
## [14] &lt;strong title="8.7 based on 1,111,637 user ratings"&gt;8.7&lt;/strong&gt;
## [15] &lt;strong title="8.7 based on 1,422,865 user ratings"&gt;8.7&lt;/strong&gt;
## [16] &lt;strong title="8.6 based on 1,597,589 user ratings"&gt;8.6&lt;/strong&gt;
## [17] &lt;strong title="8.6 based on 967,644 user ratings"&gt;8.6&lt;/strong&gt;
## [18] &lt;strong title="8.6 based on 874,276 user ratings"&gt;8.6&lt;/strong&gt;
## [19] &lt;strong title="8.6 based on 300,632 user ratings"&gt;8.6&lt;/strong&gt;
## [20] &lt;strong title="8.6 based on 1,369,079 user ratings"&gt;8.6&lt;/strong&gt;
## ...
```
---
# Select and format pieces: scores - text


```r
imdb_data %&gt;%
  html_nodes(".imdbRating strong") %&gt;%
  html_text()
##   [1] "9.2" "9.1" "9.0" "9.0" "8.9" "8.9" "8.9" "8.8" "8.8" "8.8" "8.8" "8.8" "8.7" "8.7" "8.7"
##  [16] "8.6" "8.6" "8.6" "8.6" "8.6" "8.6" "8.6" "8.6" "8.6" "8.6" "8.6" "8.5" "8.5" "8.5" "8.5"
##  [31] "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5" "8.5"
##  [46] "8.5" "8.5" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4"
##  [61] "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.4" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3"
##  [76] "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3"
##  [91] "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.3" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2"
## [106] "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2"
## [121] "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2"
## [136] "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.2" "8.1" "8.1" "8.1" "8.1" "8.1"
## [151] "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1"
## [166] "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1"
## [181] "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1"
## [196] "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1" "8.1"
## [211] "8.1" "8.1" "8.1" "8.1" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0"
## [226] "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0"
## [241] "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0" "8.0"
```
---
# Select and format pieces: scores - as-numeric


```r
imdb_data %&gt;%
  html_nodes(".imdbRating strong") %&gt;%
  html_text() %&gt;%
  as.numeric()
##   [1] 9.2 9.1 9.0 9.0 8.9 8.9 8.9 8.8 8.8 8.8 8.8 8.8 8.7 8.7 8.7 8.6 8.6 8.6 8.6 8.6 8.6 8.6
##  [23] 8.6 8.6 8.6 8.6 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5
##  [45] 8.5 8.5 8.5 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4 8.4
##  [67] 8.4 8.4 8.4 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3
##  [89] 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.3 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2
## [111] 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2
## [133] 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.2 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1
## [155] 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1
## [177] 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1
## [199] 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.1 8.0 8.0 8.0 8.0 8.0 8.0
## [221] 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0
## [243] 8.0 8.0 8.0 8.0 8.0 8.0 8.0 8.0
```

---
# Select and format pieces: scores - save


```r
scores &lt;- imdb_data %&gt;%
  html_nodes(".imdbRating strong") %&gt;%
  html_text() %&gt;%
  as.numeric()
  
```

---
# Select and format pieces: put it all together


```r
imdb_top_250 &lt;- tibble(title = titles, 
                       year = years, 
                       score = scores)

imdb_top_250
## # A tibble: 250 x 3
##    title                                              year score
##    &lt;chr&gt;                                             &lt;dbl&gt; &lt;dbl&gt;
##  1 The Shawshank Redemption                           1994   9.2
##  2 The Godfather                                      1972   9.1
##  3 The Godfather: Part II                             1974   9  
##  4 The Dark Knight                                    2008   9  
##  5 12 Angry Men                                       1957   8.9
##  6 Schindler's List                                   1993   8.9
##  7 The Lord of the Rings: The Return of the King      2003   8.9
##  8 Pulp Fiction                                       1994   8.8
##  9 The Good, the Bad and the Ugly                     1966   8.8
## 10 The Lord of the Rings: The Fellowship of the Ring  2001   8.8
## # â€¦ with 240 more rows
```


---

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; title &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; score &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Shawshank Redemption &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1994 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Godfather &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1972 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Godfather: Part II &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1974 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Dark Knight &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2008 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 12 Angry Men &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1957 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Schindler's List &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1993 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Lord of the Rings: The Return of the King &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2003 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Pulp Fiction &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1994 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Good, the Bad and the Ugly &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1966 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
# Aside: Yet another approach - pull the table with `html_table()`

- requires notation we haven't used yet (e.g., what is `[[]]`)
- requires substantial text cleaning
- If there is time we can cover this at the end of class


```r
imdb_table &lt;- html_table(imdb_data)

glimpse(imdb_table[[1]])
## Rows: 250
## Columns: 5
## $ ``             &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NAâ€¦
## $ `Rank &amp; Title` &lt;chr&gt; "1.\n      The Shawshank Redemption\n        (1994)", "2.\n      The Gâ€¦
## $ `IMDb Rating`  &lt;dbl&gt; 9.2, 9.1, 9.0, 9.0, 8.9, 8.9, 8.9, 8.8, 8.8, 8.8, 8.8, 8.8, 8.7, 8.7, â€¦
## $ `Your Rating`  &lt;chr&gt; "12345678910\n        \n        \n            \n            NOT YET REâ€¦
## $ ``             &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NAâ€¦
```

---
# Clean up / enhance


May or may not be a lot of work depending on how messy the data are

- See if you like what you got:


```r
glimpse(imdb_top_250)
## Rows: 250
## Columns: 3
## $ title &lt;chr&gt; "The Shawshank Redemption", "The Godfather", "The Godfather: Part II", "The Darâ€¦
## $ year  &lt;dbl&gt; 1994, 1972, 1974, 2008, 1957, 1993, 2003, 1994, 1966, 2001, 1999, 1994, 2010, 1â€¦
## $ score &lt;dbl&gt; 9.2, 9.1, 9.0, 9.0, 8.9, 8.9, 8.9, 8.8, 8.8, 8.8, 8.8, 8.8, 8.7, 8.7, 8.7, 8.6,â€¦
```

---
# Clean up / enhance

- Add a variable for rank


```r
imdb_top_250 %&gt;%
  mutate(
    rank = 1:nrow(imdb_top_250)
  )
## # A tibble: 250 x 4
##    title                                              year score  rank
##    &lt;chr&gt;                                             &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1 The Shawshank Redemption                           1994   9.2     1
##  2 The Godfather                                      1972   9.1     2
##  3 The Godfather: Part II                             1974   9       3
##  4 The Dark Knight                                    2008   9       4
##  5 12 Angry Men                                       1957   8.9     5
##  6 Schindler's List                                   1993   8.9     6
##  7 The Lord of the Rings: The Return of the King      2003   8.9     7
##  8 Pulp Fiction                                       1994   8.8     8
##  9 The Good, the Bad and the Ugly                     1966   8.8     9
## 10 The Lord of the Rings: The Fellowship of the Ring  2001   8.8    10
## # â€¦ with 240 more rows
```

---

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; title &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; score &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; rank &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Shawshank Redemption &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1994 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Godfather &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1972 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9.1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Godfather: Part II &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1974 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Dark Knight &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2008 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 12 Angry Men &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1957 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Schindler's List &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1993 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Lord of the Rings: The Return of the King &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2003 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Pulp Fiction &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1994 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; The Good, the Bad and the Ugly &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1966 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---
# Your Turn: Which 1995 movies made the list?

--


```r
imdb_top_250 %&gt;% 
  filter(year == 1995)
## # A tibble: 8 x 3
##   title               year score
##   &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt;
## 1 Se7en               1995   8.6
## 2 The Usual Suspects  1995   8.5
## 3 Braveheart          1995   8.3
## 4 Toy Story           1995   8.3
## 5 Heat                1995   8.2
## 6 Casino              1995   8.2
## 7 Before Sunrise      1995   8.1
## 8 La haine            1995   8
```

---
# Your turn:  Which years have the most movies on the list?

--


```r
imdb_top_250 %&gt;% 
  group_by(year) %&gt;%
  summarise(total = n()) %&gt;%
  arrange(desc(total)) %&gt;%
  head(5)
## # A tibble: 5 x 2
##    year total
##   &lt;dbl&gt; &lt;int&gt;
## 1  1995     8
## 2  2000     7
## 3  2014     7
## 4  2019     7
## 5  1957     6
```

---
# Your Turn: Visualize top 250 yearly mean score over time

--


```r
imdb_top_250 %&gt;% 
  group_by(year) %&gt;%
  summarise(avg_score = mean(score)) %&gt;%
  ggplot(aes(y = avg_score, x = year)) +
    geom_point() +
    geom_smooth(method = "lm") +
    xlab("year")
```

---

&lt;img src="lecture_5b_files/figure-html/visualise-score-year-print-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
# Other common formats: JSON


- JavaScript Object Notation (JSON). 
- A language-independent data format, and supplants extensible markup language (XML). 
- Data are sometimes stored as JSON, which requires special unpacking

---
# Unpacking JSON: Example JSON from [jsonlite](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html)

.pull-left[

```r
library(jsonlite)
json_mario &lt;- '[
  {
    "Name": "Mario",
    "Age": 32,
    "Occupation": "Plumber"
  },
  {
    "Name": "Peach",
    "Age": 21,
    "Occupation": "Princess"
  },
  {},
  {
    "Name": "Bowser",
    "Occupation": "Koopa"
  }
]'
```
]

.pull-right[

```r
mydf &lt;- fromJSON(json_mario)
mydf
##     Name Age Occupation
## 1  Mario  32    Plumber
## 2  Peach  21   Princess
## 3   &lt;NA&gt;  NA       &lt;NA&gt;
## 4 Bowser  NA      Koopa
```

]

---
# Potential challenges with web scraping


- Unreliable formatting at the source
- Data broken into many pages
- Data arriving in multiple excel file formats
- ... We will come back to this when we learn about functions next week.


&gt; Compare the display of information at [gumtree melbourne](https://www.gumtree.com.au/s-monash/l3001600) to the list on the IMDB top 250 list. What challenges can you foresee in scraping a list of the available apartments?
]

---
# Further exploring

People write R packages to access online data! Check out:

- [cricinfo by Sayani Gupta and Rob Hyndman](https://docs.ropensci.org/cricketdata/)
- [rwalkr by Earo Wang](https://github.com/earowang/rwalkr)
- [fitzRoy for AFL data](https://github.com/jimmyday12/fitzRoy/)
- [Top 40 lists of R packages by Joe Rickert](https://rviews.rstudio.com/2019/07/24/june-2019-top-40-r-packages/) - they usually include a "data" section.

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLanguage": "r",
"highlightLines": true,
"highlightSpans": false,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%/%total%",
"navigation": {
"scroll": false,
"touch": true,
"click": false
},
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'assets/mathjax-local/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
