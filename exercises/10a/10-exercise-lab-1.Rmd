---
output: html_document
---
# Your Turn: Lab exercise


```{r}
library(tidyverse)
library(broom)
library(broomstick)
library(rpart)
library(rpart.plot)
```

- Return of the paintings data
- Just predict price with year

Questions:

- If you were an auctioneer, and you were given a piece with the characteristics: 
  ...., ..., what woul you predict the log price to be?
- How many terminal nodes are there
- How many splits?
- What was the predicted value for node XX
- What is the most important variable according to this model
  - unpack what "tidy" does in this context
  - introduce "broomstick" package
  - 

```{r}
pp <- read_csv("data/paris-paintings.csv", na = c("-", "n/a", "-", ""))

pp_lm <- lm(logprice ~ Height_in + Width_in, data = pp)
pp_rp <- rpart(logprice ~ Height_in + Width_in + year, data = pp)

pp_lm_aug <- augment(pp_lm)
pp_rp_aug <- augment(pp_rp)
library(rpart.plot)
rpart.plot(pp_rp)
```

- include a bit on adding more variables
- include a bit on using more variables to predict something interesting
- link to the data dictionary: http://www2.stat.duke.edu/~cr173/Sta112_Fa16/data/paris_paintings.html
- describe why we've subsetted the data (to avoid perfect predictors?)

```{r}
pp_rp_all <- rpart(logprice ~ ., data = select(pp, 
                                               logprice,
                                               origin_author,
                                               school_pntg,
                                               artistliving,
                                               authorstyle,
                                               endbuyer,
                                               Height_in:mat,
                                               engraved:finished,
                                               relig,
                                               landsALL,
                                               arch:other))

rpart.plot(pp_rp_all, roundint = FALSE)
```

---

```{r}
tidy(pp_rp_all) %>% 
  ggplot(aes(x = importance,
             y = reorder(variable, importance))) + 
  geom_col()

```

## Price prediction 

Use the most 3 important varible to build a new tree:


```{r}
pp_rp_simple <- rpart(logprice ~ .., data = pp)
```

You are handed a new painting where the origin author and school of the painting are unknown and the material is cuivre. What is the expected price?

How does this compare to a prediction from a linear model?





